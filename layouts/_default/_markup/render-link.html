{{- /*
  Render hook for Markdown links. If a link is a bare Spotify URL
  (text equals destination), render an embed via oEmbed. Otherwise
  fall back to a normal anchor element.
*/ -}}

{{- $u := .Destination -}}
{{- $host := (urls.Parse $u).Host | lower -}}
{{- $isPlain := eq .Text .Destination -}}

{{- /*
  Embed rules:
    - Spotify: always embed when host is open.spotify.com, regardless of link text
    - YouTube: embed only for plain/bare links to avoid surprising replacements
*/ -}}

{{- if eq $host "open.spotify.com" -}}
  {{- partial "oembed.html" (dict "url" $u) -}}
{{- else if or (eq $host "youtu.be") (in $host "youtube.com") -}}
  {{- partial "oembed.html" (dict "url" $u) -}}
{{- else -}}
  <a href="{{ .Destination | safeURL }}"{{ with .Title }} title="{{ . }}"{{ end }}>{{ .Text }}</a>
{{- end -}}
